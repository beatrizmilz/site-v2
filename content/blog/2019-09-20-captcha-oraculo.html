---
title: "Quebrando Captchas - Parte VII: Oráculos"
date: "2019-10-11"
categories: ["r", "tutoriais"]
tags: ["r", "captcha"]
banner: "img/banners/captcha_07.png"
author: ["Julio"]
summary: "Nesse post não vou falar da companhia Oracle, muito menos de Pythia, a oráculo de Delphi. Aqui vou mostrar uma parte pouco discutida dos captchas, que é a possibilidade de usar oráculos para aprender."
draft: false
editor_options: 
  chunk_output_type: inline
---



<p>Um oráculo é uma função que diz para você se uma predição está correta ou incorreta. Ou seja, ela te dá a Verdade sobre a variável resposta de um novo caso da sua base no qual você só observa as explicativas.</p>
<p>O oráculo nem sempre existe em problemas reais, pois a Verdade não costuma estar disponível no momento em que fazemos a predição. Por exemplo, se estamos predizendo as vendas do próximo mês, só saberemos com certeza nossa taxa de acerto no próximo mês. Antes disso, só podemos fazer estimativas.</p>
<p>Então o oráculo é como se fosse minha base de testes? Bom, sim, mas é um tipo muito especial de base de teste. No contexto de captchas, nós podemos gerar infinitas observações novas da base, criando uma base de dados de treino virtualmente infinita.</p>
<p><img src="/img/blog/captcha-oraculo/captcha.gif" /></p>
<p>O problema é que a resposta do oráculo não é sempre clara: usualmente, o oráculo não diz <strong>o quê</strong> você errou, mas somente <strong>se</strong> você errou. Ou seja, é uma informação incompleta, censurada.</p>
<p>E como nós fazemos para tratar informação incompleta nos nossos estudos? Botamos na verossimilhança! Essa é uma possível ideia para atingir nosso objetivo final: criar modelos que aprendem a resolver captchas automaticamente.</p>
<p>Na prática, no entanto, isso é uma tarefa difícil! Nesse post vou me ater em mostrar um <em>toy model</em> de oráculo e, nos próximos posts sobre o tema, vou desenvolver mais a parte estatística da coisa.</p>
<div id="construindo-um-oraculo" class="section level2">
<h2>Construindo um oráculo</h2>
<p>Um oráculo precisa ter três partes implementadas</p>
<ol style="list-style-type: decimal">
<li>obtenção de uma imagem nova</li>
<li>teste do modelo</li>
<li>retorno</li>
</ol>
</div>
<div id="modelo" class="section level2">
<h2>Modelo</h2>
<p>Meu modelo é uma rede neural convolucional simples, exatamente igual a que está no <code>decryptr</code>. Essa rede foi treinada com 10 mil observações do MNIST, o que dá uma taxa de acerto de 95% de cada captcha (ou seja, acertar 6 letras).</p>
<p>A pergunta que eu quero responder é: será que dá para usar a informação do oráculo de alguma forma no meu modelo?</p>
<pre class="r"><code>library(keras)

data &lt;- list(
  x = array(NA, dim = c(10000, 24, 24*6, 1)),
  y = array(NA, dim = c(10000, 6, 10))
)

input &lt;- layer_input(shape = dim(data$x)[-1])

my_conv &lt;- function(obj, f) {
  obj %&gt;% 
    layer_conv_2d(
      filters = 32, 
      kernel_size = c(5, 5), 
      padding = &quot;same&quot;, 
      activation = &quot;relu&quot;
    ) %&gt;% 
    layer_max_pooling_2d()
}

n_units &lt;- 64

output &lt;- input %&gt;% 
  my_conv(16) %&gt;% 
  my_conv(32) %&gt;% 
  my_conv(64) %&gt;% 
  layer_flatten() %&gt;% 
  layer_dense(units = n_units) %&gt;% 
  layer_dropout(.1) %&gt;% 
  layer_dense(units = prod(dim(data$y)[-1])) %&gt;% 
  layer_reshape(target_shape = dim(data$y)[-1]) %&gt;% 
  layer_activation(&quot;softmax&quot;)

modelo &lt;- keras_model(input, output)</code></pre>
</div>
<div id="pacote-mimir" class="section level2">
<h2>Pacote mimir</h2>
<p>Estou montando um pacote <code>{mimir}</code> para construir oráculos e trabalhar com eles. O nome Mimir vem da figura da mitologia nórdica, conhecida por ser muito sábia. Eu achei o nome legal pois i) mimi lembra gatos, o que interage bem com as brincadeiras <code>purrr</code> e <code>forcats</code> e ii) por ter um R no final, que é sempre legal em pacotes!</p>
<p>No próximo post do tema, vou apresentar algumas formas de aproveitar a informação do oráculo na verossimilhança e alguns testes que venho desenvolvendo.</p>
<p>É isso pessoal. Happy coding ;)</p>
</div>
