<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <!-- =======================================================
    Theme Name: BizPage
    Theme URL: https://bootstrapmade.com/bizpage-bootstrap-business-template/
    Author: BootstrapMade.com
    License: https://bootstrapmade.com/license/
  ======================================================= -->
  
  {{ partial "head.html" . }}
  <script src="https://assets.pagar.me/checkout/1.1.0/checkout.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>

  <!--==========================
    Header
  ============================-->
  <header style="z-index: 91921921;">
    {{ partial "header.html" . }}
  </header><!-- #header -->

  <!--==========================
    Intro Section
  ============================-->
  <section id="intro">
    
    <div class="intro-header" style="background-image: url({{.Site.BaseURL}}{{ .Params.banner }});">
      <div class="container intro-content">
        <p id="titulo-curso">{{.Title}}</p>
        <div id="infos-praticas">
          <p class="mutavel"><i class="fa fa-calendar" aria-hidden="true"></i>  {{.Params.data}}</p>
          <p><i class="fa fa-clock" aria-hidden="true"></i>  {{.Params.hora}}</p>
          <p><i class="fa fa-map" aria-hidden="true"></i>  {{.Params.local}}</p>
          <p><i class="fa fa-money" aria-hidden="true"></i>  {{.Params.preco}}</p>
          
          {{ if isset .Params "obs"}}
            <p><i class="fa fa-info-circle" aria-hidden="true"></i>  {{.Params.obs}}</p>
          {{end}}
          
          {{ if and (isset .Params "aberto") (ne .Params.aberto "" ) }} 
          

          <button id="pagamento" class="cta-btn" style="background: none;">Inscreva-se</button>
          
          <script>
            var button = document.querySelector('#pagamento');

            // Abrir o modal ao clicar no botão
            button.addEventListener('click', function() {
        
              // inicia a instância do checkout
              var checkout = new PagarMeCheckout.Checkout({
                encryption_key: 'ek_test_KNHbR5j1vGsAH0cstlEWjEGRjngGBy',   
                success: function(data) {
                  console.log(data);
                  axios.get('https://pagarme-checkout.curso-r.com/captura?token=' + data.token + '&amount={{ .Params.unit_price }}' + '&id={{ .Params.id }}')
                        .then(function (response) {
                          // handle success
                          console.log(response);
                          if (response.data.payment_method == "boleto") {
                            url = response.data.boleto_url[0];
                            window.location.href = url; 
                          };
                        })
                        .catch(function (error) {
                          // handle error
                          console.log(error);
                        })
                },
                error: function(err) {
                	console.log(err);
                },
                close: function() {
                	console.log('The modal has been closed.');
                }
              });
              
              checkout.open({
                amount: {{ .Params.unit_price }},
                buttonText: 'Pagar',
                buttonClass: 'botao-pagamento',
                customerData: 'true',
                createToken: 'true',
                paymentMethods: 'credit_card, boleto',
                maxInstallments: 6,
                interesRate: 4.19,
                items: [
                  {
                    id: '{{ .Params.id }}',
                    title: '{{ .Params.title }}',
                    unit_price: {{ .Params.unit_price }},
                    quantity: 1,
                    tangible: true
                  }
                ],
                postbackUrl: 'https://pagarme-checkout.curso-r.com/postback'
              });
              
            })
              
          </script>
          
          {{ else }}
          
          {{ partial "form-curso.html" . }}
        
          {{ end }}
          
        </div>
      </div>
    </div>
  </section><!-- #intro -->

  <main id="main">
    
    <!--==========================
      Nossos Cursos
    ============================-->
    <section id="cursos">
      <div class="container">

          {{.Content}}
          
      </div>
        
    </section><!-- #about -->
    
    <section id="call-to-action" class="wow fadeIn">
      <div class="container text-center">
       
       {{ if and (isset .Params "paypal") (ne .Params.paypal "" ) }} 
          
          <form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
            <input type="hidden" name="cmd" value="_s-xclick">
            <input type="hidden" name="hosted_button_id" value="{{.Params.paypal}}">
            <button type="submit" value="Submit" class="cta-btn" style="background: none;">Inscreva-se</button>
            <img alt="" border="0" src="https://www.paypalobjects.com/pt_BR/i/scr/pixel.gif" width="1" height="1">
          </form>
          
          {{ else if and (isset .Params "link_inscricao") (ne .Params.link_inscricao "" ) }}
          
          <a href="{{.Params.link_inscricao}}"><button class="cta-btn" style="background: none;">Inscreva-se</button></a>
          
          {{ else }}
          
          {{ partial "form-curso.html" . }}
          
  
          {{ end }}
       
      </div>
    </section><!-- #call-to-action -->
    
    
    {{partial "professores.html" .}}
    
    {{partial "footer.html" . }}

  <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

  {{ partial "scripts.html" .}}

</body>
</html>
